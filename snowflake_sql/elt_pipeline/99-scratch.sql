SHOW PARAMETERS LIKE 'USE_CACHED_RESULT' IN SESSION;
ALTER SESSION SET USE_CACHED_RESULT = FALSE;

ALTER TABLE DEV_BRONZE_ADF.AIRBNB_DMP."AirBnBReviews_inc" MODIFY COLUMN "reviewer_name"
SET MASKING POLICY DEV_DBTGOVERN.POLICIES.COLUMN_VARCHAR_MASKING_POLICY
    USING("reviewer_name")
;

DESC TABLE DEV_BRONZE_ADF.AIRBNB_DMP."AirBnBReviews_inc"; 

SELECT "name" AS "column_name", "policy name" AS "policy_name" FROM TABLE(
    RESULT_SCAN('01c13ce0-0001-6e8a-000c-f12e000e0f5e')
);

ALTER TABLE DEV_BRONZE_ADF.AIRBNB_DMP."AirBnBReviews_inc"
MODIFY COLUMN "reviewer_name" UNSET MASKING POLICY;

ALTER TABLE DEV_BRONZE_ADF.AIRBNB_DMP."AirBnBReviews_inc" MODIFY COLUMN "reviewer_name"
SET MASKING POLICY DEV_DBTGOVERN.POLICIES.COLUMN_VARCHAR_MASKING_POLICY
    USING("reviewer_name")
;

-- First attempt
SELECT
    QUERY_ID, QUERY_TEXT, WAREHOUSE_NAME, TOTAL_ELAPSED_TIME, CREDITS_USED_CLOUD_SERVICES
FROM SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY
WHERE QUERY_ID IN (
    '01c13cda-0001-6e8d-000c-f12e000e179e', -- (DESCRIBE)
    '01c13cda-0001-6e8d-000c-f12e000e17aa', -- (DESCRIBE QUERY)
    '01c13cda-0001-6e8a-000c-f12e000e0ed6', -- (UNSET POLICY)
    '01c13cdb-0001-6e8a-000c-f12e000e0ee2'  -- (SET POLICY)
) ORDER BY START_TIME DESC
;

-- Second attempt
SELECT
    QUERY_ID, QUERY_TEXT, WAREHOUSE_NAME, TOTAL_ELAPSED_TIME, CREDITS_USED_CLOUD_SERVICES
FROM SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY
WHERE QUERY_ID IN (
    '01c13ce0-0001-6e8a-000c-f12e000e0f5e', -- (DESCRIBE)
    '01c13ce0-0001-6e8a-000c-f12e000e0f66', -- (DESCRIBE QUERY)
    '01c13ce0-0001-6e8a-000c-f12e000e0f7a', -- (UNSET POLICY)
    '01c13ce1-0001-6e8d-000c-f12e000e184e'  -- (SET POLICY)
) ORDER BY START_TIME DESC
;